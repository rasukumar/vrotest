<?xml version='1.0' encoding='UTF-8'?>
<dunes-script-module name="returnVmZoneTagNgemr" result-type="string" api-version="6.0.0" id="d1f9dd58-af02-4cb8-8842-38d5c8bb72fd" version="0.0.0" allowed-operations="vfe" category-name="com.vmware.ihis">
  <param n="vmClusterType" t="string"><![CDATA[]]></param>
  <param n="environment" t="string"><![CDATA[]]></param>
  <param n="project" t="string"><![CDATA[]]></param>
  <param n="location" t="string"><![CDATA[]]></param>
  <script encoded="false"><![CDATA[
var tag = ""
var cat = Server.getConfigurationElementCategoryWithPath("web-root")
var configEls = cat.configurationElements
var projectNm = ""

if(project != null && vmClusterType != null){
    // get project name from id
    for each(var configEl in configEls) {
        if(configEl.name == "projectIdToName"){
            var attrs =  configEl.attributes
            for each (var attr in attrs){
                    if(attr.value == project)
                        projectNm = attr.name

            }
        }
    }
        
    var type = vmClusterType.split(" ")[1]
    var env = ""

    if(vmClusterType.indexOf("ECP") != -1){
        type = "ECP"
    }

    if(vmClusterType.indexOf("ODB") != -1){
        type = "ODB"
    }

    if(vmClusterType.indexOf("Web") != -1){
        type = "WEB"
    }

    if(vmClusterType.indexOf("Citrix") != -1){
        type = "CTX"
    }

    if(vmClusterType.indexOf("DB") != -1){
        type = "DB"
    }

    if(vmClusterType.indexOf("Non Prod") != -1){
        type = "STG"
    }
   

   if(environment == "P")
        env = "Prod"
    else if(environment == "R")
        env = "DR"
    else env = "NonProd"

    tag = "HDC-"+projectNm +"-"+type+"-"+env+"-Zone"
    System.log("VM Cluster type tag: "+tag)
   
}

 return tag]]></script>
</dunes-script-module>